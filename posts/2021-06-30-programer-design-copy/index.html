<!DOCTYPE html>
<html lang="zh" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>开发中的那些坑 | HHFCodeRv</title>
<meta name="keywords" content="Go, golang">
<meta name="description" content="本篇文章罗列一些开发业务时遇到的那些坑。
微服务银弹
当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。
某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。

这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是立即开除这个人。">
<meta name="author" content="haohongfan">
<link rel="canonical" href="https://georgehao.github.io/posts/2021-06-30-programer-design-copy/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://georgehao.github.io/images/icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://georgehao.github.io/images/icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://georgehao.github.io/images/icon.png">
<link rel="apple-touch-icon" href="https://georgehao.github.io/images/icon.png">
<link rel="mask-icon" href="https://georgehao.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://georgehao.github.io/posts/2021-06-30-programer-design-copy/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://georgehao.github.io/posts/2021-06-30-programer-design-copy/">
  <meta property="og:site_name" content="HHFCodeRv">
  <meta property="og:title" content="开发中的那些坑">
  <meta property="og:description" content="本篇文章罗列一些开发业务时遇到的那些坑。
微服务银弹 当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。
某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。
这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是立即开除这个人。">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-06-30T23:27:21+08:00">
    <meta property="article:modified_time" content="2021-06-30T23:27:21+08:00">
    <meta property="article:tag" content="Go">
    <meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发中的那些坑">
<meta name="twitter:description" content="本篇文章罗列一些开发业务时遇到的那些坑。
微服务银弹
当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。
某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。

这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是立即开除这个人。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://georgehao.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "开发中的那些坑",
      "item": "https://georgehao.github.io/posts/2021-06-30-programer-design-copy/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "开发中的那些坑",
  "name": "开发中的那些坑",
  "description": "本篇文章罗列一些开发业务时遇到的那些坑。\n微服务银弹 当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。\n某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。\n这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是立即开除这个人。\n",
  "keywords": [
    "Go", "golang"
  ],
  "articleBody": "本篇文章罗列一些开发业务时遇到的那些坑。\n微服务银弹 当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。\n某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。\n这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是立即开除这个人。\n我们在一个公司有一定的技术话语权时，想落地我们学到的技术时，一定要根据实际情况来，不能想当然的去横向、纵向拆分服务。\n是否拆分微服务条件：\n公司业务是否到了一定规模 人员数量是否到了一定数量 服务治理能力是否完备，比如：配置中心，服务注册发现，日志系统等 是否有了一套完整的监控方案 持续集成，持续部署能力是否完备 服务部署是虚拟机还是 kubernetes ? 是否有足够能力运维？ …. 总之，对于业务规模较小的公司，开发人员较少时，一定不要为了拆微服务而去拆，单体服务完全够用。\n一个 class 走天下 用这个 case 吐槽下某些 php 程序员。\n相信大部分同学都有一定的强迫症，比如：函数的参数个数，函数的行数，每行的最大长度等等。当然这些判断，借助 lint 工具都能完全解决。\n对于函数参数的控制，一般正确的做法：抽离程序逻辑，尽量控制函数逻辑。实在不行的可以借助 struct 或者 class 的封装特性，往下传递参数。\n不过有些 phper 却借助了 php 的特性，搞了一些骚操作：将所有的参数或者返回值全都放在一个全局的 Class 的 static 变量里面，这样就不需要函数间传递参数了。大概形式如下：\nclass CommonService { //存储接口的入参 static public $inputParams = null; static public $output = []; static public $objMap = []; //.... } 这个写法有以下这些特点：\n这个 Common Service 基本贯穿了整个业务逻辑 不同的位置都可能在更改或者读取某个字段 造成的结果：\n不相关的业务逻辑强行耦合 某些位置刚修改的字段，可能被再次更改 预期之外的修改将整个逻辑污染 业务逻辑变得晦涩难懂 其实完全简单的封装就能解决的事情，搞出来的这种代码，让人实在忍不住吐槽。\nMySQL 里面全是 json 大部分互联网公司，MySQL 肯定是业务数据库的标配选择，毕竟运维成熟。\n我们设计数据库的时候，教科书是让我们至少遵守“第三范式”：\n不过真实业务开发中，设计 MySQL 的时候，有的时候为了查询简单，会将某些字段设计成 json, 这样就减少一张关联表的查询。这种设计其实还算是比较合理做法。\n但是更多的情况下，很多人把数据库字段设置成 json，美名是为了更好的扩展性。\n比如下面这种设计：\n由于商品的属性字段是特别多的，不同商品的属性是不固定的。为了扩展性，将商品属性字段全都塞到一个 json 里面，而且 json 也有一套逻辑在里面：aflag 与 bflag 会互相覆盖。\n这么设计造成的结果：\n商品属性字段基本处于无法控制的地步 哪些商品拥有哪些属性是不知道的 一个商品拥有哪些属性，需要通过一系列复杂的解析，计算才能知道 json 的字段是不确定的，golang/java 解析起来困难 json 字段作为扩展性，这个扩展性是我觉得是值得商榷的，因为大部分场景下能做扩展的字段，基本都是业务逻辑没有想清楚。如果一个表的某个字段是 json 类型，而且 json 里的字段能新增、修改，删除，最终就会造成这个 json 最终变得不可控，早晚走上数据库数据治理的地步。\n无脑吹 GraphQL 喜欢看博客或者公众号的同学，对 GraphQL 都不会陌生。看过 GraphqQL 的同学上来就被其特性吸引了。\n特性：\n请求你所要的数据不多不少 获取多个资源只用一个请求 描述所有的可能类型系统 API 演进无需划分版本 是不是很有吸引力？看到这些特性，我觉得大部分同学都会忍不住尝试下。\n我有幸具体落地过 GraphQL，这里就想吐槽一番。\n开发流程 GraphQL 是有默认的 Schema 的，这个 Schema 类似于 Protobuf。如果 Client、Server 对不齐这个 Schema 的话，Client 直接获取不到任何数据了。\n在使用 http RESTFUL 开发 api 接口时，差不多是这个流程：\n但是使用了 GraphQL，需要 Client/Server 双方坐下来，将各个字段都仔细讨论清楚了。了解过 GraphQL 的同学都知道，GraphQL 能从一个类型访问到另外一个任意类型，为了这个实现这个目标，双方讨论字段的过程简直慢的不可想象。可能排期都过去一星期了，字段都没对清楚。\n固然字段对清楚对开发结果的反馈是正向的，但是这个 Client/Server 之间的沟通过程真的很慢。\n网关 GraphQL 最大的问题就是网关。\n客户端使用 Graphql 的最大问题是：客户端只能有一个 Schema。所以当你有多个 Graphql Server 时想对外提供服务时，就需要合并 Schema。目前市面流行的网关 Nginx, APISIX, Kong 都不支持将 Schema 合并。\n于是你只能将所有的业务都耦合到同一个 GraphQL 中，无形中将 GraphQL 做成了单体服务。\n曾经调研过这个问题，发现只有 JS 提供一个合并 schema 的功能，其他语言基本都没有这个实现。\n复杂度 GraphQL 另外一个问题就是对查询复杂度的控制。\nGraphQL 可用从一个类型任意查询到任意一个类型。假如没有任何控制的话，客户端一次请求能将所有的数据全都拉取出来。\n当时遇到过的一个问题：客户端拉取所有的列表，又将列表中每条记录的详情，通过一次请求全部请求，导致的结果：服务器直接就崩了。\nGraphQL 提供了复杂度和深度的控制功能，但是这个复杂度和深度是很难计算的。\n综上：不建议项目使用 GraphQL。\n本文先罗列这些开发中的坑，后续再补充。 更多学习学习资料分享，关注公众号回复指令：\n回复 0，获取 《Go 面经》 回复 1，获取 《Go 源码流程图》 ",
  "wordCount" : "2119",
  "inLanguage": "zh",
  "datePublished": "2021-06-30T23:27:21+08:00",
  "dateModified": "2021-06-30T23:27:21+08:00",
  "author":{
    "@type": "Person",
    "name": "haohongfan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://georgehao.github.io/posts/2021-06-30-programer-design-copy/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "HHFCodeRv",
    "logo": {
      "@type": "ImageObject",
      "url": "https://georgehao.github.io/images/icon.png"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://georgehao.github.io/" accesskey="h" title="HHFCodeRv (Alt + H)">
                <img src="https://georgehao.github.io/images/icon.png" alt="" aria-label="logo"
                    height="35">HHFCodeRv</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://georgehao.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://gohandbook1.haohongfan.com" title="Go 源码分析与实战">
                    <span>Go 源码分析与实战</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://georgehao.github.io/archive/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://georgehao.github.io/friends/friends/" title="好友推荐">
                    <span>好友推荐</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://georgehao.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://georgehao.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      开发中的那些坑
    </h1>
    <div class="post-meta"><span title='2021-06-30 23:27:21 +0800 CST'>2021年6月30日</span>&nbsp;·&nbsp;<span>5 分钟</span>&nbsp;·&nbsp;<span>2119 字</span>&nbsp;·&nbsp;<span>haohongfan</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#微服务银弹">微服务银弹</a></li>
    <li><a href="#一个-class-走天下">一个 class 走天下</a></li>
    <li><a href="#mysql-里面全是-json">MySQL 里面全是 json</a></li>
    <li><a href="#无脑吹-graphql">无脑吹 GraphQL</a>
      <ul>
        <li><a href="#开发流程">开发流程</a></li>
        <li><a href="#网关">网关</a></li>
        <li><a href="#复杂度">复杂度</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>本篇文章罗列一些开发业务时遇到的那些坑。</p>
<h2 id="微服务银弹">微服务银弹<a hidden class="anchor" aria-hidden="true" href="#微服务银弹">#</a></h2>
<p>当前的市面上各种微服务，DDD的课收割了一波又一波的韭菜，有同学听完了课就要迫不及待的尝试一下。学习新知识的动力当然值得肯定，但是具体落地需要根据公司实际场景来。</p>
<p>某前同事找我咨询架构相关的事情，跟他一番交流让我彻底无语了。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/wfw1.png"></p>
<p>这是他们公司 JAVA 架构师落地的方案（2个开发，其中一个还是架构师，真是闹）。姑且不论架构师水平如何，当我看到 2 个后端开发，拆出了 17 个服务时，我的建议是<strong>立即开除这个人</strong>。</p>
<p>我们在一个公司有一定的技术话语权时，想落地我们学到的技术时，一定要根据实际情况来，不能想当然的去横向、纵向拆分服务。</p>
<p>是否拆分微服务条件：</p>
<ol>
<li>公司业务是否到了一定规模</li>
<li>人员数量是否到了一定数量</li>
<li>服务治理能力是否完备，比如：配置中心，服务注册发现，日志系统等</li>
<li>是否有了一套完整的监控方案</li>
<li>持续集成，持续部署能力是否完备</li>
<li>服务部署是虚拟机还是 kubernetes ? 是否有足够能力运维？</li>
<li>&hellip;.</li>
</ol>
<p>总之，对于业务规模较小的公司，开发人员较少时，一定不要为了拆微服务而去拆，单体服务完全够用。</p>
<h2 id="一个-class-走天下">一个 class 走天下<a hidden class="anchor" aria-hidden="true" href="#一个-class-走天下">#</a></h2>
<p>用这个 case 吐槽下某些 php 程序员。</p>
<p>相信大部分同学都有一定的强迫症，比如：函数的参数个数，函数的行数，每行的最大长度等等。当然这些判断，借助 lint 工具都能完全解决。</p>
<p>对于函数参数的控制，一般正确的做法：抽离程序逻辑，尽量控制函数逻辑。实在不行的可以借助 struct 或者 class 的封装特性，往下传递参数。</p>
<p>不过有些 phper 却借助了 php 的特性，搞了一些骚操作：将所有的参数或者返回值全都放在一个全局的 Class 的 static 变量里面，这样就不需要函数间传递参数了。大概形式如下：</p>
<pre tabindex="0"><code>class CommonService
{

    //存储接口的入参
    static public $inputParams = null;
    static public $output = [];
    static public $objMap = [];
    
    //....
}
</code></pre><p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/static_class.png"></p>
<p>这个写法有以下这些特点：</p>
<ol>
<li>这个 Common Service 基本贯穿了整个业务逻辑</li>
<li>不同的位置都可能在更改或者读取某个字段</li>
</ol>
<p>造成的结果：</p>
<ol>
<li>不相关的业务逻辑强行耦合</li>
<li>某些位置刚修改的字段，可能被再次更改</li>
<li>预期之外的修改将整个逻辑污染</li>
<li>业务逻辑变得晦涩难懂</li>
</ol>
<p>其实完全简单的封装就能解决的事情，搞出来的这种代码，让人实在忍不住吐槽。</p>
<h2 id="mysql-里面全是-json">MySQL 里面全是 json<a hidden class="anchor" aria-hidden="true" href="#mysql-里面全是-json">#</a></h2>
<p>大部分互联网公司，MySQL 肯定是业务数据库的标配选择，毕竟运维成熟。</p>
<p>我们设计数据库的时候，教科书是让我们至少遵守“第三范式”：</p>
<p>不过真实业务开发中，设计 MySQL 的时候，有的时候为了查询简单，会将某些字段设计成 json, 这样就减少一张关联表的查询。这种设计其实还算是比较合理做法。</p>
<p>但是更多的情况下，很多人把数据库字段设置成 json，美名是为了更好的扩展性。</p>
<p>比如下面这种设计：</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/json_goods.png"></p>
<p>由于商品的属性字段是特别多的，不同商品的属性是不固定的。为了扩展性，将商品属性字段全都塞到一个 json 里面，而且 json 也有一套逻辑在里面：aflag 与 bflag 会互相覆盖。</p>
<p>这么设计造成的结果：</p>
<ol>
<li>商品属性字段基本处于无法控制的地步</li>
<li>哪些商品拥有哪些属性是不知道的</li>
<li>一个商品拥有哪些属性，需要通过一系列复杂的解析，计算才能知道</li>
<li>json 的字段是不确定的，golang/java 解析起来困难</li>
</ol>
<p>json 字段作为扩展性，这个扩展性是我觉得是值得商榷的，因为大部分场景下能做扩展的字段，基本都是业务逻辑没有想清楚。如果一个表的某个字段是 json 类型，而且 json 里的字段能新增、修改，删除，最终就会造成这个 json 最终变得不可控，早晚走上数据库数据治理的地步。</p>
<h2 id="无脑吹-graphql">无脑吹 GraphQL<a hidden class="anchor" aria-hidden="true" href="#无脑吹-graphql">#</a></h2>
<p>喜欢看博客或者公众号的同学，对 GraphQL 都不会陌生。看过 GraphqQL 的同学上来就被其特性吸引了。</p>
<p>特性：</p>
<ol>
<li>请求你所要的数据不多不少</li>
<li>获取多个资源只用一个请求</li>
<li>描述所有的可能类型系统</li>
<li>API 演进无需划分版本</li>
</ol>
<p>是不是很有吸引力？看到这些特性，我觉得大部分同学都会忍不住尝试下。</p>
<p>我有幸具体落地过 GraphQL，这里就想吐槽一番。</p>
<h3 id="开发流程">开发流程<a hidden class="anchor" aria-hidden="true" href="#开发流程">#</a></h3>
<p>GraphQL 是有默认的 Schema 的，这个 Schema 类似于 Protobuf。如果 Client、Server 对不齐这个 Schema 的话，Client 直接获取不到任何数据了。</p>
<p>在使用 http RESTFUL 开发 api 接口时，差不多是这个流程：</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/http_api3.png"></p>
<p>但是使用了 GraphQL，需要 Client/Server 双方坐下来，将各个字段都仔细讨论清楚了。了解过 GraphQL 的同学都知道，GraphQL 能从一个类型访问到另外一个任意类型，为了这个实现这个目标，双方讨论字段的过程简直慢的不可想象。可能排期都过去一星期了，字段都没对清楚。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/graphql-api.png"></p>
<p>固然字段对清楚对开发结果的反馈是正向的，但是这个 Client/Server 之间的沟通过程真的很慢。</p>
<h3 id="网关">网关<a hidden class="anchor" aria-hidden="true" href="#网关">#</a></h3>
<p>GraphQL 最大的问题就是网关。</p>
<p>客户端使用 Graphql 的最大问题是：客户端只能有一个 Schema。所以当你有多个 Graphql Server 时想对外提供服务时，就需要合并 Schema。目前市面流行的网关 Nginx, APISIX, Kong 都不支持将 Schema 合并。</p>
<p>于是你只能将所有的业务都耦合到同一个 GraphQL 中，无形中将 GraphQL 做成了单体服务。</p>
<p>曾经调研过这个问题，发现只有 JS 提供一个合并 schema 的功能，其他语言基本都没有这个实现。</p>
<h3 id="复杂度">复杂度<a hidden class="anchor" aria-hidden="true" href="#复杂度">#</a></h3>
<p>GraphQL 另外一个问题就是对查询复杂度的控制。</p>
<p>GraphQL 可用从一个类型任意查询到任意一个类型。假如没有任何控制的话，客户端一次请求能将所有的数据全都拉取出来。</p>
<p>当时遇到过的一个问题：客户端拉取所有的列表，又将列表中每条记录的详情，通过一次请求全部请求，导致的结果：服务器直接就崩了。</p>
<p>GraphQL 提供了复杂度和深度的控制功能，但是这个复杂度和深度是很难计算的。</p>
<p>综上：不建议项目使用 GraphQL。</p>
<p>本文先罗列这些开发中的坑，后续再补充。 更多学习学习资料分享，关注公众号回复指令：</p>
<ul>
<li>回复 0，获取 《Go 面经》</li>
<li>回复 1，获取 《Go 源码流程图》</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/georgehao/img/me.png"></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://georgehao.github.io/tags/go/">Go</a></li>
      <li><a href="https://georgehao.github.io/tags/golang/">Golang</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://georgehao.github.io/posts/2021-07-10-govscpp/">
    <span class="title">« 上一页</span>
    <br>
    <span>我为什么从 C&#43;&#43; 转到了 Go</span>
  </a>
  <a class="next" href="https://georgehao.github.io/posts/2021-06-27-timer/">
    <span class="title">下一页 »</span>
    <br>
    <span>Go timer 是如何被调度的</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on x"
            href="https://x.com/intent/tweet/?text=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91&amp;url=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f&amp;hashtags=Go%2cgolang">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f&amp;title=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91&amp;summary=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91&amp;source=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f&title=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on whatsapp"
            href="https://api.whatsapp.com/send?text=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91%20-%20https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on telegram"
            href="https://telegram.me/share/url?text=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91&amp;url=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 开发中的那些坑 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e5%bc%80%e5%8f%91%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91&u=https%3a%2f%2fgeorgehao.github.io%2fposts%2f2021-06-30-programer-design-copy%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© 2021 <a href="https://georgehao.github.io/">haohongfan</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
